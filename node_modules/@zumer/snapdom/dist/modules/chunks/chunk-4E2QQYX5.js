/*
* SnapDOM
* v2.0.1
* Author: Juan Martin Muda
* License: MIT
*/
import{e as S,f as A,g as w,h as C,i as b}from"./chunk-5ZWTRQ52.js";import{a as c,b as y,f as d,g as h,j as g,o as p}from"./chunk-GZX3IERM.js";import{b as o}from"./chunk-Q55H7S7M.js";async function I(e=document,t={}){let{embedFonts:k=!0,useProxy:i=""}=t,F=t.cache??t.cacheOpt??"full";y(F);try{await document.fonts?.ready}catch{}try{g()}catch{}c.session=c.session||{},c.session.styleCache||(c.session.styleCache=new WeakMap),c.image=c.image||new Map,c.background=c.background||new Map;try{await b(e,void 0,c.session.styleCache,{useProxy:i})}catch{}let n=[],m=[];try{if(e&&e.nodeType===1){let s=e.querySelectorAll?Array.from(e.querySelectorAll("*")):[];m=[e,...s],n=[],e.tagName==="IMG"&&e.getAttribute("src")&&n.push(e),n.push(...Array.from(e.querySelectorAll?.("img[src]")||[]))}else e?.querySelectorAll&&(n=Array.from(e.querySelectorAll("img[src]")),m=Array.from(e.querySelectorAll("*")))}catch{}let f=[];for(let s of n){let a=s?.currentSrc||s?.src;if(a&&!c.image.has(a)){let l=Promise.resolve().then(async()=>{let r=await d(a,{as:"dataURL",useProxy:i});r?.ok&&typeof r.data=="string"&&c.image.set(a,r.data)}).catch(()=>{});f.push(l)}}for(let s of m){let a="";try{a=s?.style?.backgroundImage||"",(!a||a==="none")&&(a=p(s).backgroundImage)}catch{}if(a&&a!=="none"){let l=a.match(/url\((?:[^()"']+|"(?:[^"]*)"|'(?:[^']*)')\)/gi)||[];for(let r of l){let u=Promise.resolve().then(()=>h(r,{...t,useProxy:i})).catch(()=>{});f.push(u)}}}if(k)try{let s=A(e),a=w(e);if(typeof o=="function"?o():!!o){let r=new Set(Array.from(s).map(u=>String(u).split("__")[0]).filter(Boolean));await C(r,3)}await S({required:s,usedCodepoints:a,exclude:t.excludeFonts,localFonts:t.localFonts,useProxy:t.useProxy??i})}catch{}await Promise.allSettled(f)}export{I as a};
