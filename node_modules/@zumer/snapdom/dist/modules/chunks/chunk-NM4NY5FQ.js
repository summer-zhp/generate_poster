/*
* SnapDOM
* v2.0.0
* Author: Juan Martin Muda
* License: MIT
*/
import{b}from"./chunk-FTKOXG2W.js";function S(e){return typeof e=="string"&&/^data:image\/svg\+xml/i.test(e)}function C(e){let n=e.indexOf(",");return n>=0?decodeURIComponent(e.slice(n+1)):""}function v(e){return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(e)}`}function D(e){let n=[],t="",i=0;for(let a=0;a<e.length;a++){let o=e[a];o==="("&&i++,o===")"&&(i=Math.max(0,i-1)),o===";"&&i===0?(n.push(t),t=""):t+=o}return t.trim()&&n.push(t),n.map(a=>a.trim()).filter(Boolean)}function k(e){let n=[],t="",i=0;for(let o=0;o<e.length;o++){let c=e[o];c==="("&&i++,c===")"&&(i=Math.max(0,i-1)),c===","&&i===0?(n.push(t.trim()),t=""):t+=c}t.trim()&&n.push(t.trim());let a=[];for(let o of n){if(/\binset\b/i.test(o))continue;let c=o.match(/-?\d+(?:\.\d+)?px/gi)||[],[s="0px",r="0px",u="0px"]=c,l=o.replace(/-?\d+(?:\.\d+)?px/gi,"").replace(/\binset\b/ig,"").trim().replace(/\s{2,}/g," "),p=!!l&&l!==",";a.push(`drop-shadow(${s} ${r} ${u}${p?` ${l}`:""})`)}return a.join(" ")}function y(e){let n=D(e),t=null,i=null,a=null,o=[];for(let s of n){let r=s.indexOf(":");if(r<0)continue;let u=s.slice(0,r).trim().toLowerCase(),l=s.slice(r+1).trim();u==="box-shadow"?a=l:u==="filter"?t=l:u==="-webkit-filter"?i=l:o.push([u,l])}if(a){let s=k(a);s&&(t=t?`${t} ${s}`:s,i=i?`${i} ${s}`:s)}let c=[...o];return t&&c.push(["filter",t]),i&&c.push(["-webkit-filter",i]),c.map(([s,r])=>`${s}:${r}`).join(";")}function F(e){return e.replace(/([^{}]+)\{([^}]*)\}/g,(n,t,i)=>`${t}{${y(i)}}`)}function H(e){return e=e.replace(/<style[^>]*>([\s\S]*?)<\/style>/gi,(n,t)=>n.replace(t,F(t))),e=e.replace(/style=(['"])([\s\S]*?)\1/gi,(n,t,i)=>`style=${t}${y(i)}${t}`),e}function M(e){if(!b()||!S(e))return e;try{let n=C(e),t=H(n);return v(t)}catch{return e}}async function W(e,n){let{width:t,height:i,scale:a=1,dpr:o=1,meta:c={},backgroundColor:s}=n;e=M(e);let r=new Image;r.loading="eager",r.decoding="sync",r.crossOrigin="anonymous",r.src=e,await r.decode();let u=r.naturalWidth,l=r.naturalHeight,p=Number.isFinite(c.w0)?c.w0:u,x=Number.isFinite(c.h0)?c.h0:l,f,h,w=Number.isFinite(t),$=Number.isFinite(i);if(w&&$)f=Math.max(1,t),h=Math.max(1,i);else if(w){let g=t/Math.max(1,p);f=t,h=x*g}else if($){let g=i/Math.max(1,x);h=i,f=p*g}else f=u,h=l;f=f*a,h=h*a;let d=document.createElement("canvas");d.width=f*o,d.height=h*o,d.style.width=`${f}px`,d.style.height=`${h}px`;let m=d.getContext("2d");return o!==1&&m.scale(o,o),s&&(m.save(),m.fillStyle=s,m.fillRect(0,0,f,h),m.restore()),m.drawImage(r,0,0,f,h),d}export{W as a};
