/*
* SnapDOM
* v2.0.1
* Author: Juan Martin Muda
* License: MIT
*/
import{a as R}from"./chunks/chunk-4E2QQYX5.js";import{a as h}from"./chunks/chunk-4Z46XXMY.js";import{a as E}from"./chunks/chunk-5ZWTRQ52.js";import{b as P,c as d,d as S,h as I}from"./chunks/chunk-DTQFIIVX.js";import"./chunks/chunk-GZX3IERM.js";import{b as C}from"./chunks/chunk-Q55H7S7M.js";function z(e){if(typeof e=="string"){let r=e.toLowerCase().trim();if(r==="disabled"||r==="full"||r==="auto"||r==="soft")return r}return"soft"}function A(e={}){let r=e.format??"png";r==="jpg"&&(r="jpeg");let n=z(e.cache);return{debug:e.debug??!1,fast:e.fast??!0,scale:e.scale??1,exclude:e.exclude??[],excludeMode:e.excludeMode??"hide",filter:e.filter??null,filterMode:e.filterMode??"hide",placeholders:e.placeholders!==!1,embedFonts:e.embedFonts??!1,iconFonts:Array.isArray(e.iconFonts)?e.iconFonts:e.iconFonts?[e.iconFonts]:[],localFonts:Array.isArray(e.localFonts)?e.localFonts:[],excludeFonts:e.excludeFonts??void 0,fallbackURL:e.fallbackURL??void 0,cache:n,useProxy:typeof e.useProxy=="string"?e.useProxy:"",width:e.width??null,height:e.height??null,format:r,type:e.type??"svg",quality:e.quality??.92,dpr:e.dpr??(window.devicePixelRatio||1),backgroundColor:e.backgroundColor??(["jpeg","webp"].includes(r)?"#ffffff":null),filename:e.filename??"snapDOM",outerTransforms:e.outerTransforms??!0,outerShadows:e.outerShadows??!1}}function O(...e){return P(...e),c}var c=Object.assign(_,{plugins:O}),M=Symbol("snapdom.internal"),f=Symbol("snapdom.internal.silent"),x=!1;async function _(e,r){if(!e)throw new Error("Element cannot be null or undefined");let n=A(r);if(I(n,r&&r.plugins),C()&&(n.embedFonts===!0||W(e)))for(let o=0;o<3;o++)try{await B(e,r),x=!1}catch{}return n.iconFonts&&n.iconFonts.length>0&&E(n.iconFonts),n.snap||(n.snap={toPng:(o,l)=>c.toPng(o,l),toSvg:(o,l)=>c.toSvg(o,l)}),c.capture(e,n,M)}c.capture=async(e,r,n)=>{if(n!==M)throw new Error("[snapdom.capture] is internal. Use snapdom(...) instead.");let o=await h(e,r),l={img:async(t,a)=>{let{toImg:s}=await import("./exporters/toImg.js");return s(o,{...t,...a||{}})},svg:async(t,a)=>{let{toSvg:s}=await import("./exporters/toImg.js");return s(o,{...t,...a||{}})},canvas:async(t,a)=>{let{toCanvas:s}=await import("./exporters/toCanvas.js");return s(o,{...t,...a||{}})},blob:async(t,a)=>{let{toBlob:s}=await import("./exporters/toBlob.js");return s(o,{...t,...a||{}})},png:async(t,a)=>{let{rasterize:s}=await import("./chunks/rasterize-JS5G2XHH.js");return s(o,{...t,...a||{},format:"png"})},jpeg:async(t,a)=>{let{rasterize:s}=await import("./chunks/rasterize-JS5G2XHH.js");return s(o,{...t,...a||{},format:"jpeg"})},webp:async(t,a)=>{let{rasterize:s}=await import("./chunks/rasterize-JS5G2XHH.js");return s(o,{...t,...a||{},format:"webp"})},download:async(t,a)=>{let{download:s}=await import("./exporters/download.js");return s(o,{...t,...a||{}})}},g={...r,export:{url:o},exports:{svg:async t=>{let{toSvg:a}=await import("./exporters/toImg.js");return a(o,{...r,...t||{},[f]:!0})},canvas:async t=>{let{toCanvas:a}=await import("./exporters/toCanvas.js");return a(o,{...r,...t||{},[f]:!0})},png:async t=>{let{rasterize:a}=await import("./chunks/rasterize-JS5G2XHH.js");return a(o,{...r,...t||{},format:"png",[f]:!0})},jpeg:async t=>{let{rasterize:a}=await import("./chunks/rasterize-JS5G2XHH.js");return a(o,{...r,...t||{},format:"jpeg",[f]:!0})},jpg:async t=>{let{rasterize:a}=await import("./chunks/rasterize-JS5G2XHH.js");return a(o,{...r,...t||{},format:"jpeg",[f]:!0})},webp:async t=>{let{rasterize:a}=await import("./chunks/rasterize-JS5G2XHH.js");return a(o,{...r,...t||{},format:"webp",[f]:!0})},blob:async t=>{let{toBlob:a}=await import("./exporters/toBlob.js");return a(o,{...r,...t||{},[f]:!0})},img:async t=>{let{toImg:a}=await import("./exporters/toImg.js");return a(o,{...r,...t||{},[f]:!0})}}},m=await S("defineExports",g),N=Object.assign({},...m.filter(t=>t&&typeof t=="object")),p={...l,...N};p.jpeg&&!p.jpg&&(p.jpg=(t,a)=>p.jpeg(t,a));function T(t,a){let s={...r,...a||{}};return(t==="jpeg"||t==="jpg")&&(s.backgroundColor==null||s.backgroundColor==="transparent")&&(s.backgroundColor="#ffffff"),s}let v=!1,k=Promise.resolve();async function u(t,a){let s=async()=>{let y=p[t];if(!y)throw new Error(`[snapdom] Unknown export type: ${t}`);let F=T(t,a),b={...r,export:{type:t,options:F,url:o}};await d("beforeExport",b);let j=await y(b,F);return await d("afterExport",b,j),v||(v=!0,await d("afterSnap",r)),j};return k=k.then(s)}let w={url:o,toRaw:()=>o,to:(t,a)=>u(t,a),toImg:t=>u("img",t),toSvg:t=>u("svg",t),toCanvas:t=>u("canvas",t),toBlob:t=>u("blob",t),toPng:t=>u("png",t),toJpg:t=>u("jpg",t),toWebp:t=>u("webp",t),download:t=>u("download",t)};for(let t of Object.keys(p)){let a="to"+t.charAt(0).toUpperCase()+t.slice(1);w[a]||(w[a]=s=>u(t,s))}return w};c.toRaw=(e,r)=>c(e,r).then(n=>n.toRaw());c.toImg=(e,r)=>c(e,r).then(n=>n.toImg());c.toSvg=(e,r)=>c(e,r).then(n=>n.toSvg());c.toCanvas=(e,r)=>c(e,r).then(n=>n.toCanvas());c.toBlob=(e,r)=>c(e,r).then(n=>n.toBlob());c.toPng=(e,r)=>c(e,{...r,format:"png"}).then(n=>n.toPng());c.toJpg=(e,r)=>c(e,{...r,format:"jpeg"}).then(n=>n.toJpg());c.toWebp=(e,r)=>c(e,{...r,format:"webp"}).then(n=>n.toWebp());c.download=(e,r)=>c(e,r).then(n=>n.download());async function B(e,r){if(x)return;let n={...r,fast:!0,embedFonts:!0,scale:.2},o;try{o=await h(e,n)}catch{}await new Promise(l=>requestAnimationFrame(()=>requestAnimationFrame(l))),o&&await new Promise(l=>{let i=new Image;try{i.decoding="sync",i.loading="eager"}catch{}i.style.cssText="position:fixed;left:0px;top:0px;width:10px;height:10px;opacity:0.01;pointer-events:none;",i.src=o,document.body.appendChild(i),(async()=>{try{typeof i.decode=="function"&&await i.decode()}catch{}let g=performance.now();for(;!(i.complete&&i.naturalWidth>0)&&performance.now()-g<900;)await new Promise(m=>setTimeout(m,200));await new Promise(m=>requestAnimationFrame(m));try{i.remove()}catch{}l()})()}),e.querySelectorAll("canvas").forEach(l=>{try{let i=l.getContext("2d",{willReadFrequently:!0});i&&i.getImageData(0,0,1,1)}catch{}}),x=!0}function W(e){let r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT);for(;r.nextNode();){let n=r.currentNode,o=getComputedStyle(n),l=o.backgroundImage&&o.backgroundImage!=="none",i=o.maskImage&&o.maskImage!=="none"||o.webkitMaskImage&&o.webkitMaskImage!=="none";if(l||i||n.tagName==="CANVAS")return!0}return!1}var K=c;export{K as default,O as plugins,R as preCache,c as snapdom};
